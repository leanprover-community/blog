{#  -*- coding: utf-8 -*- #}
{% import 'base_helper.tmpl' as base with context %}
{% import 'base_header.tmpl' as header with context %}
{% import 'base_footer.tmpl' as footer with context %}
{{ set_locale(lang) }}
{#  <html> tag is included by base.html_headstart #}
{{ base.html_headstart() }}
{% block extra_head %}
{#  Leave this block alone. #}
{% endblock %}
{{ template_hooks['extra_head']() }}
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">{{ messages("Skip to main content") }}</a>
    <div id="container">
        {{ header.html_header() }}
        <main id="content">
            {% block content %}{% endblock %}

        <script src="https://giscus.app/client.js"
            data-repo="leanprover-community/blog"
            data-repo-id="MDEwOlJlcG9zaXRvcnkzOTM3OTE1ODU="
            data-category="Announcements"
            data-category-id="DIC_kwDOF3jIYc4CQntU"
            data-mapping="og:title"
            data-strict="1"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="light"
            data-lang="en"
            crossorigin="anonymous"
            async>
        </script>
        </main>
        {{ footer.html_footer() }}
    </div>
    {{ base.late_load_js() }}
    {% block extra_js %}{% endblock %}

    <!-- Mermaid JS for diagram rendering -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default'
        });

        // Convert code blocks with mermaid syntax to mermaid diagrams
        document.addEventListener('DOMContentLoaded', function() {
            // Find all pre.code blocks that contain mermaid syntax (starting with "graph")
            const preBlocks = document.querySelectorAll('pre.code.literal-block');

            preBlocks.forEach((pre, index) => {
                const content = pre.textContent.trim();
                // Check if this looks like a mermaid diagram
                if (content.startsWith('graph ') ||
                    content.startsWith('sequenceDiagram') ||
                    content.startsWith('classDiagram') ||
                    content.startsWith('stateDiagram') ||
                    content.startsWith('erDiagram') ||
                    content.startsWith('journey') ||
                    content.startsWith('gantt') ||
                    content.startsWith('pie') ||
                    content.startsWith('flowchart')) {

                    // Create a new div for mermaid
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    mermaidDiv.textContent = content;

                    // Replace the pre block with the mermaid div
                    pre.parentNode.replaceChild(mermaidDiv, pre);
                }
            });

            // Render all mermaid diagrams
            mermaid.run();
        });
    </script>

    {{ body_end }}
    {{ template_hooks['body_end']() }}
</body>
</html>

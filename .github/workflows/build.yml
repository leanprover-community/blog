name: deploy site

on:
  push:
    branches-ignore:
      - 'deploy'
  schedule:
    - cron: '4 * * * *'
  workflow_dispatch:

jobs:
  build:
    name: Build HTML
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Install uv
        uses: astral-sh/setup-uv@bd01e18f51369d5a26f1651c3cb451d3417e3bba # v6.3.1
        with:
          version: "0.7.15"
          python-version: "3.13.5"
          activate-environment: true

      - name: install Python dependencies
        run: uv pip install --preview -r pylock.toml

      - name: build site
        run: ./deploy.sh
        env:
          git_hash: ${{ github.sha }}
          DEPLOY_GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          github_repo: ${{ github.repository }}
          github_ref: ${{ github.ref }}
